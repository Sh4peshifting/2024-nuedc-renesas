{% extends "website/base.html" %}
{% load static %}
{% block mainbody %}
<div class="container">
    <div class="row">
        <div class="col-md-5 col-lg-4 order-md-last">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span>硬件控制</span>
            </h4>
            <div class="mb-3">
                <div class="card  ">
                    <div class="card-body">
                        <h5 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-car-front" viewBox="0 0 16 16">
                                <path d="M4 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0m10 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM4.862 4.276 3.906 6.19a.51.51 0 0 0 .497.731c.91-.073 2.35-.17 3.597-.17s2.688.097 3.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 10.691 4H5.309a.5.5 0 0 0-.447.276"/>
                                <path d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM4.82 3a1.5 1.5 0 0 0-1.379.91l-.792 1.847a1.8 1.8 0 0 1-.853.904.8.8 0 0 0-.43.564L1.03 8.904a1.5 1.5 0 0 0-.03.294v.413c0 .796.62 1.448 1.408 1.484 1.555.07 3.786.155 5.592.155s4.037-.084 5.592-.155A1.48 1.48 0 0 0 15 9.611v-.413q0-.148-.03-.294l-.335-1.68a.8.8 0 0 0-.43-.563 1.8 1.8 0 0 1-.853-.904l-.792-1.848A1.5 1.5 0 0 0 11.18 3z"/>
                            </svg>
                            运输车概况
                        </h5>
                        <div class="car-state-box"></div>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <div class="card  ">
                    <div class="card-body">
                        <h5 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-lightbulb" viewBox="0 0 16 16">
                                <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/>
                            </svg>
                            灯光
                        </h5>
                        <div class="btn-group col-12 mx-auto" role="group" aria-label="Basic example">
                            <button type="button" id="light_on" class="btn btn-light btn-lg"
                                    data-bs-toggle="modal" data-bs-target="#modal_msg">打开
                            </button>
                            <button type="button" id="light_off" class="btn btn-secondary btn-lg"
                                    data-bs-toggle="modal" data-bs-target="#modal_msg">关闭
                            </button>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="modal_msg" data-bs-backdrop="static" data-bs-keyboard="false"
                     tabindex="-1" aria-labelledby="info_modal_msg" aria-hidden="true">
                    <div class="modal-dialog  modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="info_modal_msg">提示</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                是否确认操作？
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">取消
                                </button>
                                <button type="button" id="confirm" class="btn btn-primary"
                                        data-bs-dismiss="modal">确认
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-info-square" viewBox="0 0 16 16">
                                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                            </svg>
                            操作说明
                        </h5>
                        <p class="card-text">概况显示仓库环境状态及货架占用状况，
                            货架概览显示货架具体信息，点击相应位置卡片可进行出入库、换货操作，
                            运输车概况显示当前运输车状态，点击灯光控制灯光开关。</p>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-md-7 col-lg-8">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span>数据面板</span>
            </h4>

            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                             class="bi bi-bar-chart" viewBox="0 0 16 16">
                            <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>
                        </svg>
                        概况
                    </h5>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="alert alert-danger" role="alert">
                                <b>烟雾警报 <span id="alarm_disp">正常</span></b>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="alert alert-warning" role="alert">
                                <b>货架 <span id="cargo_disp">0</span>/6</b>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="alert alert-primary" role="alert">
                                <b>温度 <span id="temp_disp">25</span>℃</b>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="alert alert-info" role="alert">
                                <b>湿度 <span id="hum_disp">30</span>%</b>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <div class="card ">
                    <div class="card-body">
                        <h5 class="card-title" id='shelf'>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-box-seam" viewBox="0 0 16 16">
                                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                            </svg>
                            货架概览
                        </h5>
                        <div class="cargo-list-box"></div>
                        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                             tabindex="-1" aria-labelledby="cargo_man_msg" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="cargo_man_msg">货物管理</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <h5>操作：</h5>
                                        <div class="btn-group col-12 mb-3" role="group"
                                             aria-label="Basic radio toggle button group" id="btn-group">

                                            <input type="radio" class="btn-check" name="btnradio1" id="in_storage"
                                                   autocomplete="off"
                                                   checked>
                                            <label class="btn btn-outline-primary" for="in_storage">入库</label>

                                            <input type="radio" class="btn-check" name="btnradio1" id="out_storage"
                                                   autocomplete="off">
                                            <label class="btn btn-outline-primary" for="out_storage">出库</label>

                                            <input type="radio" class="btn-check" name="btnradio1" id="sw_cargo"
                                                   autocomplete="off">
                                            <label class="btn btn-outline-primary" for="sw_cargo">换货</label>
                                        </div>
                                        <select class="form-select mb-3" aria-label="Default select example"
                                                id="sw_cargo_sel" disabled>
                                            <option value=null selected>选择目标货架号</option>
                                            <option value="1-1-1">1-1-1</option>
                                            <option value="1-1-2">1-1-2</option>
                                            <option value="1-1-3">1-1-3</option>
                                            <option value="1-2-1">1-2-1</option>
                                            <option value="1-2-2">1-2-2</option>
                                            <option value="1-1-3">1-1-3</option>
                                        </select>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消
                                        </button>
                                        <button type="button" class="btn btn-primary" id="cargo_btn"
                                                data-bs-dismiss="modal">确认
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    let cargo_loc;

    function get_cargo_id(click_id) {
        cargo_loc = click_id;
    }

    $(document).ready(function () {
        let flag = {
            'light': 0
        };
        $('#light_on').click(function () {
            flag['light'] = 1;
        });
        $('#light_off').click(function () {
            flag['light'] = 2;
        });

        let cargo_op = 'in_storage';
        $('#in_storage').click(function () {
            cargo_op = 'in_storage'
            $('#sw_cargo_sel').attr('disabled', true);
        })
        $('#out_storage').click(function () {
            cargo_op = 'out_storage';
            $('#sw_cargo_sel').attr('disabled', true);
        })
        $('#sw_cargo').click(function () {
            cargo_op = 'sw_cargo';
            $('#sw_cargo_sel').removeAttr('disabled');
        })

        $('#cargo_btn').click(function () {
            let cargo_id = $('#sw_cargo_sel').val();
            console.log(cargo_id, cargo_loc);
            $.ajax({
                url: '/change_cargo/',
                type: 'POST',
                data: {
                    'cargo_op': cargo_op,
                    'cargo_id': cargo_id,
                    'cargo_loc': cargo_loc
                },
                success: function (receivedData) {
                    if (receivedData['status'] == 0) {
                        alert('操作成功');
                    } else {
                        alert('操作失败');
                    }
                }
            });
        });

        $('#confirm').click(function () {
            if (flag['light'] == 1) {
                $.ajax({
                    url: '/light_on/',
                    type: 'GET',
                    success: function (receivedData) {
                        console.log(receivedData);
                    }
                });
            } else if (flag['light'] == 2) {
                $.ajax({
                    url: '/light_off/',
                    type: 'GET',
                    success: function (receivedData) {
                        console.log(receivedData);
                    }
                });
            }

        });
        flag['light'] = 0;
    });
</script>
<script type="text/javascript" src="{% static 'state_template.js' %}"></script>
{% endblock %}

